(base) C:\Users\Gading\Downloads\final_DL> python AKTPB0.py
TinyImageNet found at ./data\tiny-imagenet-200
Using device: cuda
Configuration: batch_size=256, warmup_epochs=5, warmup_lambda=0.5
C:\Users\Gading\Downloads\final_DL\AKTPB0.py:477: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  b2.load_state_dict(torch.load(b2_path, map_location=cfg.device))
C:\Users\Gading\Downloads\final_DL\AKTPB0.py:484: FutureWarning: You are using `torch.load` with `weights_only=False` (the current default value), which uses the default pickle module implicitly. It is possible to construct malicious pickle data which will execute arbitrary code during unpickling (See https://github.com/pytorch/pytorch/blob/main/SECURITY.md#untrusted-models for more details). In a future release, the default value for `weights_only` will be flipped to `True`. This limits the functions that could be executed during unpickling. Arbitrary objects will no longer be allowed to be loaded via this mode unless they are explicitly allowlisted by the user via `torch.serialization.add_safe_globals`. We recommend you start setting `weights_only=True` for any use case where you don't have full control of the loaded file. Please open an issue on GitHub for any issues related to this experimental feature.
  r18.load_state_dict(torch.load(r18_path, map_location=cfg.device))
Teachers ready (TinyImageNet-finetuned).
Starting student from ImageNet-1K pretrained weights.

============================================================
Starting AKTP Distillation with fixes:
  ✓ ImageNet-1K pretrained student
  ✓ Normalized AKTP features
  ✓ Warmup phase with fixed lambda
  ✓ Gradient clipping
  ✓ Clamped lambda range [0.05, 0.6]
============================================================

AKTP Distill E1/50: 100%|███████████████████████████████████████████████████████████| 391/391 [01:25<00:00,  4.57it/s, loss=1.32, λ=0.5, ce=1.12, kd=0.197]
Epoch 1 [WARMUP]: val_acc=50.56% λ=0.5000 CE=1.4240 KD=0.2015
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=50.56%)
AKTP Distill E2/50: 100%|████████████████████████████████████████████████████████████| 391/391 [01:27<00:00,  4.45it/s, loss=1.29, λ=0.5, ce=1.1, kd=0.187]
Epoch 2 [WARMUP]: val_acc=54.58% λ=0.5000 CE=1.0140 KD=0.2035
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=54.58%)
AKTP Distill E3/50: 100%|████████████████████████████████████████████████████████████| 391/391 [01:27<00:00,  4.49it/s, loss=1.11, λ=0.5, ce=0.911, kd=0.2]
Epoch 3 [WARMUP]: val_acc=56.06% λ=0.5000 CE=0.8833 KD=0.2020
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=56.06%)
AKTP Distill E4/50: 100%|██████████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.72it/s, loss=1.03, λ=0.5, ce=0.843, kd=0.185]
Epoch 4 [WARMUP]: val_acc=57.58% λ=0.5000 CE=0.7906 KD=0.2008
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=57.58%)
AKTP Distill E5/50: 100%|███████████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.76it/s, loss=0.966, λ=0.5, ce=0.77, kd=0.19]
Epoch 5 [WARMUP]: val_acc=57.46% λ=0.5000 CE=0.7175 KD=0.1988
AKTP Distill E6/50: 100%|████████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.74it/s, loss=0.791, λ=0.46, ce=0.653, kd=0.129]
Epoch 6: val_acc=58.13% λ=0.4115 CE=0.5152 KD=0.1274
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=58.13%)
AKTP Distill E7/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:21<00:00,  4.82it/s, loss=0.775, λ=0.434, ce=0.641, kd=0.122]
Epoch 7: val_acc=58.39% λ=0.4691 CE=0.5481 KD=0.1374
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=58.39%)
AKTP Distill E8/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:20<00:00,  4.85it/s, loss=0.663, λ=0.465, ce=0.519, kd=0.132]
Epoch 8: val_acc=59.32% λ=0.4625 CE=0.4966 KD=0.1359
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=59.32%)
AKTP Distill E9/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:19<00:00,  4.93it/s, loss=0.659, λ=0.437, ce=0.523, kd=0.125]
Epoch 9: val_acc=59.14% λ=0.4550 CE=0.4523 KD=0.1342
AKTP Distill E10/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:19<00:00,  4.93it/s, loss=0.621, λ=0.439, ce=0.481, kd=0.122]
Epoch 10: val_acc=58.85% λ=0.4494 CE=0.4128 KD=0.1323
AKTP Distill E11/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:19<00:00,  4.94it/s, loss=0.553, λ=0.459, ce=0.411, kd=0.127]
Epoch 11: val_acc=58.61% λ=0.4431 CE=0.3820 KD=0.1308
AKTP Distill E12/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  4.98it/s, loss=0.495, λ=0.436, ce=0.353, kd=0.128]
Epoch 12: val_acc=58.91% λ=0.4376 CE=0.3502 KD=0.1290
AKTP Distill E13/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  4.99it/s, loss=0.481, λ=0.434, ce=0.346, kd=0.119]
Epoch 13: val_acc=59.37% λ=0.4326 CE=0.3207 KD=0.1273
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=59.37%)
AKTP Distill E14/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:18<00:00,  5.00it/s, loss=0.495, λ=0.397, ce=0.36, kd=0.115]
Epoch 14: val_acc=59.41% λ=0.4288 CE=0.2968 KD=0.1256
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=59.41%)
AKTP Distill E15/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  5.01it/s, loss=0.433, λ=0.422, ce=0.298, kd=0.121]
Epoch 15: val_acc=59.61% λ=0.4238 CE=0.2772 KD=0.1234
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=59.61%)
AKTP Distill E16/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.03it/s, loss=0.406, λ=0.409, ce=0.274, kd=0.114]
Epoch 16: val_acc=59.04% λ=0.4203 CE=0.2578 KD=0.1220
AKTP Distill E17/50: 100%|█████████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.02it/s, loss=0.383, λ=0.4, ce=0.247, kd=0.12]
Epoch 17: val_acc=59.97% λ=0.4166 CE=0.2421 KD=0.1206
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=59.97%)
AKTP Distill E18/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.03it/s, loss=0.36, λ=0.405, ce=0.229, kd=0.116]
Epoch 18: val_acc=59.17% λ=0.4134 CE=0.2241 KD=0.1192
AKTP Distill E19/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.03it/s, loss=0.368, λ=0.385, ce=0.237, kd=0.112]
Epoch 19: val_acc=59.79% λ=0.4096 CE=0.2126 KD=0.1178
AKTP Distill E20/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.02it/s, loss=0.395, λ=0.367, ce=0.271, kd=0.105]
Epoch 20: val_acc=59.39% λ=0.4066 CE=0.2032 KD=0.1164
AKTP Distill E21/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.03it/s, loss=0.323, λ=0.374, ce=0.199, kd=0.107]
Epoch 21: val_acc=59.44% λ=0.4037 CE=0.1947 KD=0.1149
AKTP Distill E22/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:23<00:00,  4.68it/s, loss=0.369, λ=0.37, ce=0.241, kd=0.111]
Epoch 22: val_acc=59.84% λ=0.4027 CE=0.1797 KD=0.1146
AKTP Distill E23/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.72it/s, loss=0.324, λ=0.374, ce=0.194, kd=0.11]
Epoch 23: val_acc=59.77% λ=0.4007 CE=0.1657 KD=0.1139
AKTP Distill E24/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.72it/s, loss=0.273, λ=0.409, ce=0.143, kd=0.115]
Epoch 24: val_acc=60.38% λ=0.3987 CE=0.1597 KD=0.1129
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=60.38%)
AKTP Distill E25/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:22<00:00,  4.73it/s, loss=0.269, λ=0.423, ce=0.139, kd=0.116]
Epoch 25: val_acc=60.54% λ=0.3980 CE=0.1480 KD=0.1126
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=60.54%)
AKTP Distill E26/50: 100%|██████████████████████████████████████████████████████| 391/391 [04:21<00:00,  1.50it/s, loss=0.295, λ=0.383, ce=0.169, kd=0.111]
Epoch 26: val_acc=60.72% λ=0.3976 CE=0.1367 KD=0.1124
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=60.72%)
AKTP Distill E27/50: 100%|██████████████████████████████████████████████████████| 391/391 [04:49<00:00,  1.35it/s, loss=0.271, λ=0.397, ce=0.147, kd=0.109]
Epoch 27: val_acc=60.17% λ=0.3958 CE=0.1336 KD=0.1114
AKTP Distill E28/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:23<00:00,  4.68it/s, loss=0.246, λ=0.397, ce=0.126, kd=0.107]
Epoch 28: val_acc=61.07% λ=0.3949 CE=0.1267 KD=0.1111
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.07%)
AKTP Distill E29/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:25<00:00,  4.57it/s, loss=0.252, λ=0.369, ce=0.131, kd=0.106]
Epoch 29: val_acc=60.91% λ=0.3947 CE=0.1185 KD=0.1112
AKTP Distill E30/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:25<00:00,  4.57it/s, loss=0.252, λ=0.365, ce=0.129, kd=0.105]
Epoch 30: val_acc=61.45% λ=0.3939 CE=0.1140 KD=0.1108
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.45%)
AKTP Distill E31/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  4.98it/s, loss=0.233, λ=0.387, ce=0.111, kd=0.106]
Epoch 31: val_acc=61.04% λ=0.3935 CE=0.1092 KD=0.1106
AKTP Distill E32/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.12it/s, loss=0.237, λ=0.389, ce=0.11, kd=0.114]
Epoch 32: val_acc=61.43% λ=0.3941 CE=0.1023 KD=0.1113
AKTP Distill E33/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.10it/s, loss=0.226, λ=0.395, ce=0.0999, kd=0.111]
Epoch 33: val_acc=61.50% λ=0.3944 CE=0.0969 KD=0.1116
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.50%)
AKTP Distill E34/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.09it/s, loss=0.227, λ=0.361, ce=0.101, kd=0.108]
Epoch 34: val_acc=61.75% λ=0.3938 CE=0.0925 KD=0.1117
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.75%)
AKTP Distill E35/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.06it/s, loss=0.212, λ=0.399, ce=0.0882, kd=0.113]
Epoch 35: val_acc=61.78% λ=0.3946 CE=0.0887 KD=0.1121
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.78%)
AKTP Distill E36/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.11it/s, loss=0.205, λ=0.408, ce=0.0808, kd=0.113]
Epoch 36: val_acc=61.78% λ=0.3936 CE=0.0861 KD=0.1122
AKTP Distill E37/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.12it/s, loss=0.222, λ=0.355, ce=0.0999, kd=0.107]
Epoch 37: val_acc=61.90% λ=0.3944 CE=0.0828 KD=0.1127
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=61.90%)
AKTP Distill E38/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.12it/s, loss=0.209, λ=0.378, ce=0.0838, kd=0.112]
Epoch 38: val_acc=62.20% λ=0.3942 CE=0.0809 KD=0.1128
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.20%)
AKTP Distill E39/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  5.00it/s, loss=0.211, λ=0.393, ce=0.077, kd=0.123]
Epoch 39: val_acc=62.55% λ=0.3946 CE=0.0784 KD=0.1133
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.55%)
AKTP Distill E40/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.09it/s, loss=0.207, λ=0.362, ce=0.0849, kd=0.109]
Epoch 40: val_acc=62.67% λ=0.3956 CE=0.0762 KD=0.1138
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.67%)
AKTP Distill E41/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.10it/s, loss=0.206, λ=0.358, ce=0.0809, kd=0.11]
Epoch 41: val_acc=62.55% λ=0.3950 CE=0.0740 KD=0.1142
AKTP Distill E42/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.11it/s, loss=0.196, λ=0.383, ce=0.0744, kd=0.111]
Epoch 42: val_acc=62.61% λ=0.3967 CE=0.0724 KD=0.1147
AKTP Distill E43/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.09it/s, loss=0.202, λ=0.391, ce=0.0733, kd=0.118]
Epoch 43: val_acc=62.73% λ=0.3960 CE=0.0717 KD=0.1148
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.73%)
AKTP Distill E44/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:16<00:00,  5.08it/s, loss=0.199, λ=0.388, ce=0.0746, kd=0.112]
Epoch 44: val_acc=62.69% λ=0.3972 CE=0.0703 KD=0.1154
AKTP Distill E45/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:17<00:00,  5.05it/s, loss=0.201, λ=0.388, ce=0.0754, kd=0.113]
Epoch 45: val_acc=62.57% λ=0.3972 CE=0.0695 KD=0.1157
AKTP Distill E46/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:18<00:00,  5.00it/s, loss=0.196, λ=0.384, ce=0.0724, kd=0.112]
Epoch 46: val_acc=62.80% λ=0.3980 CE=0.0687 KD=0.1161
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.80%)
AKTP Distill E47/50: 100%|██████████████████████████████████████████████████████| 391/391 [01:18<00:00,  4.98it/s, loss=0.193, λ=0.404, ce=0.068, kd=0.115]
Epoch 47: val_acc=62.95% λ=0.3977 CE=0.0692 KD=0.1157
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=62.95%)
AKTP Distill E48/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:18<00:00,  4.96it/s, loss=0.194, λ=0.407, ce=0.0666, kd=0.117]
Epoch 48: val_acc=63.03% λ=0.3988 CE=0.0681 KD=0.1164
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=63.03%)
AKTP Distill E49/50: 100%|███████████████████████████████████████████████████████| 391/391 [01:19<00:00,  4.94it/s, loss=0.201, λ=0.388, ce=0.07, kd=0.118]
Epoch 49: val_acc=63.10% λ=0.3978 CE=0.0681 KD=0.1160
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=63.10%)
AKTP Distill E50/50: 100%|█████████████████████████████████████████████████████| 391/391 [01:19<00:00,  4.94it/s, loss=0.198, λ=0.368, ce=0.0718, kd=0.112]
Epoch 50: val_acc=63.20% λ=0.3985 CE=0.0676 KD=0.1167
  ✓ Saved best distilled student at ./checkpoints_aktp\b0_aktp_tiny_best.pth (acc=63.20%)
Saved training history to ./results_aktp\aktp_distill_history.json
Saved training plots to ./results_aktp\aktp_distill_plots.png

============================================================
Distillation complete!
Best validation accuracy: 63.20%
Best checkpoint: ./checkpoints_aktp\b0_aktp_tiny_best.pth
Latest checkpoint: ./checkpoints_aktp\b0_aktp_tiny_latest.pth
History JSON: ./results_aktp\aktp_distill_history.json
History plot: ./results_aktp\aktp_distill_plots.png
============================================================